{"version":3,"sources":["resolver/evaluation.image.resolver.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AACA,kFAA6E;AAC7E,gFAA4E;AAC5E,2CAAwE;AACxE,6CAA4D;AAO5D,IAAa,uBAAuB,GAApC;IAEI,YACqD,sBAA8C;QAA9C,2BAAsB,GAAtB,sBAAsB,CAAwB;IAC/F,CAAC;IAIC,gBAAgB,CAAC,GAAY,EAAE,IAA8B;;YAC/D,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,CAAC;YAC9B,IAAI,CAAC,YAAY,EAAE;gBACf,MAAM,IAAI,sBAAa,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC;aACxC;YACD,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,sBAAsB,CAAC,mBAAmB,CAAC,GAAG,EAAE,YAAY,CAAC,CAAC;YACxF,OAAO,EAAE,IAAI,EAAE,GAAG,EAAE,OAAO,EAAE,aAAa,EAAE,MAAM,EAAE,CAAC;QACzD,CAAC;KAAA;IAIK,qBAAqB,CAAC,GAAY,EAAE,IAAmF;;YACzH,MAAM,EAAE,YAAY,EAAE,UAAU,EAAE,OAAO,EAAE,MAAM,EAAE,GAAG,IAAI,CAAC;YAC3D,IAAI,CAAC,YAAY,IAAI,CAAC,UAAU,IAAI,CAAC,OAAO,IAAI,CAAC,MAAM,EAAE;gBACrD,MAAM,IAAI,sBAAa,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC;aACxC;YACD,MAAM,IAAI,CAAC,sBAAsB,CAAC,qBAAqB,CAAC,YAAY,EAAE,UAAU,EAAE,OAAO,EAAE,MAAM,CAAC,CAAC;YACnG,OAAO,EAAE,IAAI,EAAE,GAAG,EAAE,OAAO,EAAE,UAAU,EAAE,CAAC;QAC9C,CAAC;KAAA;IAIK,qBAAqB,CAAC,GAAY,EAAE,IAAoB;;YAC1D,MAAM,EAAE,EAAE,EAAE,GAAG,IAAI,CAAC;YACpB,IAAI,CAAC,EAAE,EAAE;gBACL,MAAM,IAAI,sBAAa,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC;aACxC;YACD,MAAM,IAAI,CAAC,sBAAsB,CAAC,qBAAqB,CAAC,EAAE,CAAC,CAAC;YAC5D,OAAO,EAAE,IAAI,EAAE,GAAG,EAAE,OAAO,EAAE,UAAU,EAAE,CAAC;QAC9C,CAAC;KAAA;CACJ,CAAA;AA9BG;IADC,eAAK,CAAC,kBAAkB,CAAC;;;;+DAQzB;AAID;IADC,kBAAQ,CAAC,uBAAuB,CAAC;;;;oEAQjC;AAID;IADC,kBAAQ,CAAC,uBAAuB,CAAC;;;;oEAQjC;AArCQ,uBAAuB;IAFnC,kBAAQ,CAAC,iBAAiB,CAAC;IAC3B,wBAAe,CAAC,4CAAoB,CAAC;IAI7B,WAAA,eAAM,CAAC,iDAAsB,CAAC,CAAA;qCAA0C,iDAAsB;GAH1F,uBAAuB,CAsCnC;AAtCY,0DAAuB","file":"evaluation.image.resolver.js","sourcesContent":["import { EvaluationImagesData } from \"../interface/evaluationimage/evaluation.images.data\";\nimport { EvaluationImageService } from \"../service/evaluation.image.service\";\nimport { ExceptionInterceptor } from \"../interceptor/exception.interceptor\";\nimport { Inject, HttpException, UseInterceptors } from \"@nestjs/common\";\nimport { Resolver, Query, Mutation } from \"@nestjs/graphql\";\nimport { Data } from \"../interface/data\";\nimport { Request } from \"express\";\n\n/* 评价图片Resolver */\n@Resolver(\"EvaluationImage\")\n@UseInterceptors(ExceptionInterceptor)\nexport class EvaluationImageResolver {\n\n    constructor(\n        @Inject(EvaluationImageService) private readonly evaluationImageService: EvaluationImageService\n    ) { }\n\n    /* 查询指定评价的图片，同时返回图片访问url */\n    @Query(\"evaluationImages\")\n    async evaluationImages(req: Request, body: { evaluationId: number }): Promise<EvaluationImagesData> {\n        const { evaluationId } = body;\n        if (!evaluationId) {\n            throw new HttpException(\"缺少参数\", 400);\n        }\n        const images = await this.evaluationImageService.getEvaluationImages(req, evaluationId);\n        return { code: 200, message: \"获取指定评价的图片成功\", images };\n    }\n\n    /* 为指定评价添加一张图片，创建评价时也可以添加图片 */\n    @Mutation(\"createEvaluationImage\")\n    async createEvaluationImage(req: Request, body: { evaluationId: number, bucketName: string, rawName: string, base64: string }): Promise<Data> {\n        const { evaluationId, bucketName, rawName, base64 } = body;\n        if (!evaluationId || !bucketName || !rawName || !base64) {\n            throw new HttpException(\"缺少参数\", 400);\n        }\n        await this.evaluationImageService.createEvaluationImage(evaluationId, bucketName, rawName, base64);\n        return { code: 200, message: \"创建评价图片成功\" };\n    }\n\n    /* 删除指定评价图片，同时删除存储图片 */\n    @Mutation(\"deleteEvaluationImage\")\n    async deleteEvaluationImage(req: Request, body: { id: number }): Promise<Data> {\n        const { id } = body;\n        if (!id) {\n            throw new HttpException(\"缺少参数\", 400);\n        }\n        await this.evaluationImageService.deleteEvaluationImage(id);\n        return { code: 200, message: \"删除评价图片成功\" };\n    }\n}\n"]}